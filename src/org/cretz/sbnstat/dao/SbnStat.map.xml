<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="SbnStat">
    
    <insert id="insertUser" parameterType="User" 
            useGeneratedKeys="true" keyProperty="id">
        INSERT INTO User
            (Username, Url)
        VALUES
            (#{username}, #{url})
    </insert>
    
    <insert id="insertPost" parameterType="Post" 
            useGeneratedKeys="true" keyProperty="id">
        INSERT INTO Post
            (SbnId, UserId, Type, Date, Title, Url, FrontPage, RecommendationCount)
        VALUES
            (#{sbnId}, #{user.id}, #{type}, #{date}, #{title}, #{url}, #{frontPage}, #{recommendationCount})
    </insert>
    
    <insert id="insertComment" parameterType="Comment" 
            useGeneratedKeys="true" keyProperty="id">
        INSERT INTO Comment (
            SbnId,
            ParentId,
            TopLevelParentId,
            UserId,
            PostId,
            Depth,
            Subject,
            Contents,
            RecommendationCount,
            Date
        ) VALUES (
            #{sbnId},
            #{parent == null ? null : parent.id},
            #{topLevelParent == null ? null : topLevelParent.id},
            #{user.id},
            #{post.id},
            #{depth},
            #{subject},
            #{contents},
            #{recommendationCount},
            #{date}
        )
    </insert>
    
</mapper>